#!/usr/bin/env bash
# Launch TensorBoard dashboard (requires: pip install -e ".[rl]")
# Usage: bun run tensorboard
#        bun run tensorboard -- --logdir /path/to/specific/run
# Default: shows all runs under sim-artifacts/runs/ for comparison
cd "$(dirname "$0")/.."

# Default to runs directory if no --logdir specified
if ! echo "$*" | grep -q -- '--logdir'; then
  set -- --logdir sim-artifacts/runs "$@"
fi

# Resolve the python interpreter from the venv
if [ -x .venv/bin/python3 ]; then
  PY=.venv/bin/python3
else
  PY=python3
fi

# Launch TensorBoard with warnings suppressed:
#   -W ignore::UserWarning  â€” suppresses pkg_resources deprecation warning (tensorboard 2.20 upstream issue)
#   Monkey-patches global_init to suppress "TensorFlow not found" stderr print
exec "$PY" -W "ignore::UserWarning" -c "
import sys
sys.argv[0] = 'tensorboard'
import tensorboard.main_lib as _ml
_orig = _ml.global_init
def _quiet_init():
    import io as _io
    _err = sys.stderr
    sys.stderr = _io.StringIO()
    _orig()
    sys.stderr = _err
_ml.global_init = _quiet_init
from tensorboard.main import run_main
run_main()
" "$@"
